# =============================================================================
# Spring Gateway Toolkit - Application Configuration
# =============================================================================
# All values can be overridden via environment variables using UPPERCASE_SNAKE_CASE
# Example: server.port -> SERVER_PORT, gateway.caching.enabled -> GATEWAY_CACHING_ENABLED
# =============================================================================

server:
  port: ${SERVER_PORT:8080}

spring:
  application:
    name: ${SPRING_APPLICATION_NAME:api-gateway}

  # Spring Security OAuth2 Configuration
  security:
    oauth2:
      client:
        registration:
          main:
            client-id: ${OAUTH2_CLIENT_ID:}
            client-secret: ${OAUTH2_CLIENT_SECRET:}
            client-name: OAuth2 Provider
            provider: main
            scope: ${OAUTH2_SCOPES:openid,profile,email}
            redirect-uri: "{baseUrl}/swagger-ui/oauth2-redirect.html"
            authorization-grant-type: authorization_code
        provider:
          main:
            issuer-uri: ${OAUTH2_ISSUER_URI:}
            authorization-uri: ${OAUTH2_AUTHORIZATION_URI:}
            token-uri: ${OAUTH2_TOKEN_URI:}
            jwk-set-uri: ${OAUTH2_JWK_SET_URI:}
            user-info-uri: ${OAUTH2_USER_INFO_URI:}
            user-name-attribute: ${OAUTH2_USER_NAME_ATTRIBUTE:sub}
      resourceserver:
        jwt:
          issuer-uri: ${OAUTH2_ISSUER_URI:}
          jwk-set-uri: ${OAUTH2_JWK_SET_URI:}

  # Spring Cloud Gateway Configuration
  cloud:
    gateway:
      discovery:
        locator:
          enabled: ${GATEWAY_DISCOVERY_ENABLED:false}
          lower-case-service-id: true
      default-filters:
        - PreserveHostHeader
      routes: []  # Define routes in your custom application.yml or use a discovery profile

# =============================================================================
# Gateway Toolkit Configuration
# =============================================================================

gateway:
  # Request/Response Logging
  logging:
    enabled: ${GATEWAY_LOGGING_ENABLED:true}
    level: ${GATEWAY_LOGGING_LEVEL:info}
    requests: []  # Define in your custom application.yml
    # Example:
    # - paths: ["/api/**"]
    #   methods: ["*"]
    #   exclude-body: false

  # Response Caching
  caching:
    enabled: ${GATEWAY_CACHING_ENABLED:false}
    provider: caffeine
    default-ttl: ${GATEWAY_CACHE_DEFAULT_TTL:86400}
    max-size: ${GATEWAY_CACHE_MAX_SIZE:10000}
    rules: []  # Define in your custom application.yml
    # Example:
    # - paths: ["/api/products"]
    #   methods: [GET]
    #   ttl: 3600

  # CORS Configuration
  cors:
    enabled: ${GATEWAY_CORS_ENABLED:true}
    allowed-origins: ${GATEWAY_CORS_ORIGINS:}
    allowed-methods:
      - GET
      - POST
      - PUT
      - PATCH
      - DELETE
      - OPTIONS
    allowed-headers:
      - "*"
    max-age: 3600
    allow-credentials: true

  # Security Configuration
  security:
    enabled: ${GATEWAY_SECURITY_ENABLED:false}
    guest-allowed-paths: []  # Define in your custom application.yml
    oauth2:
      enabled: ${GATEWAY_OAUTH2_ENABLED:false}
      provider:
        issuer-uri: ${OAUTH2_ISSUER_URI:}
        authorization-uri: ${OAUTH2_AUTHORIZATION_URI:}
        token-uri: ${OAUTH2_TOKEN_URI:}
        jwk-set-uri: ${OAUTH2_JWK_SET_URI:}
        user-info-uri: ${OAUTH2_USER_INFO_URI:}
        user-name-attribute: ${OAUTH2_USER_NAME_ATTRIBUTE:sub}
      client:
        id: ${OAUTH2_CLIENT_ID:}
        secret: ${OAUTH2_CLIENT_SECRET:}
        scopes: ${OAUTH2_SCOPES:openid,profile,email}

  # Conman Mock API Framework
  conman:
    enabled: ${GATEWAY_CONMAN_ENABLED:false}
    servlet-uri-mappings:
      - /mock/**
    mapping-files:
      - classpath:conman.yml
    banner-path: classpath:conman-banner.txt

# =============================================================================
# SpringDoc / Swagger Configuration
# =============================================================================

springdoc:
  swagger-ui:
    path: /swagger-ui.html
    persist-authorization: true
    urls-primary-name: API Gateway
    config-url: /v3/api-docs/swagger-config
  api-docs:
    enabled: true
    groups:
      enabled: true
  packages-to-scan: io.github.springgateway

# =============================================================================
# Actuator / Monitoring
# =============================================================================

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,caches
  endpoint:
    health:
      show-details: always
    metrics:
      enabled: true
    caches:
      enabled: true
  metrics:
    enable:
      cache: true

# =============================================================================
# Application Info
# =============================================================================

info:
  application:
    name: '@project.artifactId@'
    description: "Spring Gateway Toolkit Application"
    version: '@project.version@'

# =============================================================================
# Logging
# =============================================================================

logging:
  level:
    root: INFO
    org.springframework.cloud.gateway: ${GATEWAY_LOG_LEVEL:WARN}
    io.github.springgateway: ${TOOLKIT_LOG_LEVEL:INFO}
